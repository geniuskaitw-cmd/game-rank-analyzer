name: 測試資料抓取與儲存
on:
  workflow_dispatch:
    # 僅允許手動從 Actions 分頁執行此工作流

jobs:
  run_fetch_test:
    runs-on: ubuntu-latest

    # === 新增：賦予工作 "寫入" 權限 ===
    permissions:
      contents: write
    # ==================================

    steps:
      - name: 1. Checkout repository code
        uses: actions/checkout@v4
        with:
          persist-credentials: false
          fetch-depth: 0 
          
      - name: 2. Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: 3. Install dependencies
        run: |
          # 僅安裝 fetch_ios_rss.py 需要的函式庫
          pip install requests
          
      # === 僅執行步驟 2 (抓取原始榜單) ===
      - name: 4. Run fetch_ios_rss.py (Fetch Ranks)
        run: python scripts/fetch_ios_rss.py
        
      # === 提交變動 (將 JSON 數據推回儲存庫) ===
      # 這是我們要測試的關鍵：確認 .gitignore 修正後，檔案會被提交
      - name: 5. Commit and Push generated data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # 提交 data 資料夾中的所有內容
          file_pattern: data/*
          commit_message: "🤖 Test: Auto-generated raw rank data"
          commit_user_name: GitHub Actions Bot
          commit_user_email: actions@github.com

